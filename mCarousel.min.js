!function(){"use strict";var t=function(){var t=document.createElement("div"),s=t.style,i=["webkit","Moz","ms","O"],e=0,n=i.length,h=function(t){return t.replace(/-\D/g,function(t){return t.charAt(1).toUpperCase()})},r=function(t,s){return getComputedStyle(t,null)[h(s)]},o=function(t,s,i){return t.addEventListener(s,i,!1)},a=function(t,s,i){if("string"==typeof s)return o(t,s,i);for(var e=0,n=s.length;e<n;e++)o(t,s[e],i)},d=function(t,s){return-1<(" "+t.className+" ").indexOf(" "+s+" ")},l=function(t,s){d(t,s)||(t.className+=" "+s)},f=function(t,s){if(d(t,s)){var i=new RegExp("(\\s|^)"+s+"(\\s|$)");t.className=t.className.replace(i,"")}},c=function(t){var r=h(t);if(r in s)return r;for(e=0;e<n;e++)if(r=h(i[e]+"-"+t),r in s)return r;return null},x=function(t){var r=h(t);if(r in s)return!0;for(e=0;e<n;e++)if(r=h(i[e]+"-"+t),r in s)return!0;return!1},_=function(){var s,i,e=document.body;return e.appendChild(t),x("transform")&&(i=c("transform"),t.style[i]="translate3d(1px,1px,1px)",s=r(t,i)),e.removeChild(t),void 0!==s&&s.length>0&&"none"!==s},m=Date.now||function(){return(new Date).getTime()};return{css:r,on:a,addClass:l,removeClass:f,prefix:c,supportCss:x,support3d:_,getTime:m}}(),s=function(s,i){this.wrapper="string"==typeof s?document.querySelector(s):s,this.scroller=this.wrapper.children[0],this.elements=this.scroller.children,this.length=this.elements.length,this.length<3||(this._hasTransform3d=t.support3d(),this._hasTransform2d=t.supportCss("transform"),this._hasTransition=t.supportCss("transition"),this._prefixTransition=t.prefix("transition"),this._prefixTransform=t.prefix("transform"),this.index=i.index||0,this.ratio=i.scale||.8,this.active=i.active||"active",this.duration=i.duration||400,this.before=i.before||function(){},this.after=i.after||function(){},this.locked=i.locked||!1,this.length<4&&(this.locked=!0),this.viewW=this.wrapper.offsetWidth,this.singleW=i.width||this.elements[this.index].offsetWidth,this.centerX=(this.viewW-this.singleW)/2,this.diffX=(this.singleW-this.singleW*this.ratio)/2,this.leftX=this._hasTransform2d?-this.diffX:0,this.rightX=this._hasTransform2d?this.viewW-this.singleW+this.diffX:this.viewW-this.singleW,this.spaceX=this.centerX-this.leftX,this.leftPos=this.leftX-this.singleW*this.ratio,this.rightPos=this.rightX+this.singleW*this.ratio,this.rate=Math.abs(this.singleW*this.ratio/this.spaceX),this.dRatio=1-this.ratio,this._init())};s.prototype={_init:function(){this._setup(),this._bindEvent()},_setup:function(){"static"===t.css(this.wrapper,"position")&&(this.wrapper.style.position="relative");for(var s=0;s<this.length;s++)"static"===t.css(this.elements[s],"position")&&(this.elements[s].style.position="absolute"),this._setDisplay(s,"none");this._setActive(this.index)},_bindEvent:function(){t.on(this.wrapper,"touchstart",this._start.bind(this)),t.on(this.wrapper,"touchmove",this._move.bind(this)),t.on(this.wrapper,"touchend",this._end.bind(this))},_start:function(s){this.startTime=t.getTime(),this._reset()},_move:function(s){if(s.touches&&!this.animated){s.preventDefault();var i=s.touches[0].pageX,e=s.touches[0].pageY,n=null===this.moveX?0:i-this.moveX,h=null===this.moveY?0:e-this.moveY,r=t.getTime();if(this.deltaX+=n,this.deltaY+=h,!this.locked){var o=Math.abs(this.deltaX/this.spaceX),a=this.elements[this.index]._x+n,d=this.elements[this.nIndex]._x+n,l=this.elements[this.oIndex]._x+n,f=1-this.dRatio*o,c=this.ratio+this.dRatio*o;if(f<this.ratio&&(f=this.ratio),c>1&&(c=1),this._setTransform(this.index,a,0,f.toFixed(2)),this.deltaX>0){this._setTransform(this.oIndex,l,0,c.toFixed(2)),this._setTransform(this.nIndex,d,0,this.ratio),this.moved||(this._setFourth(this.oIndex,"right"),this._setStacks("right"),this.moved=!0);var x=this.elements[this.dIndex]._x+n*this.rate;this._setTransform(this.dIndex,x,0,this.ratio),x>this.rightPos&&(this._setDisplay(this.dIndex,"none"),this._setFourth(this.oIndex,"right"),this._setStacks("right")),f<=this.ratio&&(this._setDisplay(this.nIndex,"none"),this._setActive(this.oIndex),this._reset())}else if(this.deltaX<0){this._setTransform(this.nIndex,d,0,c.toFixed(2)),this._setTransform(this.oIndex,l,0,this.ratio),this.moved||(this._setFourth(this.nIndex,"left"),this._setStacks("left"),this.moved=!0);var x=this.elements[this.dIndex]._x+n*this.rate;this._setTransform(this.dIndex,x,0,this.ratio),x<this.leftPos&&(this._setDisplay(this.dIndex,"none"),this._setFourth(this.nIndex,"left"),this._setStacks("left")),f<=this.ratio&&(this._setDisplay(this.oIndex,"none"),this._setActive(this.nIndex),this._reset())}}this.moveX=i,this.moveY=e,r-this.startTime>=200&&(this.startTime=r)}},_end:function(s){if(s.changedTouches&&(this.locked||this.moved)&&!this.animated){var i=t.getTime()-this.startTime,e=Math.abs(this.deltaX);i<200&&e>10||e>this.spaceX/2?this.deltaX>0?this.prev():this.next():!this.locked&&this._reStore()}},_setTransition:function(t,s){s=s||0,this.elements[t].style[this._prefixTransition]="all "+s+"ms"},_setTransform:function(t,s,i,e){this._hasTransform3d?this.elements[t].style[this._prefixTransform]="translate3d("+s+"px,"+i+"px, 0px) scale3d("+e+","+e+", 1)":this._hasTransform2d?this.elements[t].style[this._prefixTransform]="translate("+s+"px,"+i+"px) scale("+e+","+e+")":(this.elements[t].style.left=s+"px",this.elements[t].style.top=i+"px"),this.elements[t]._x=s,this.elements[t]._y=i,this.elements[t]._ratio=e},_setTransitionEnd:function(){this.animated=!1,this._setTransition(this.index,0),this._setTransition(this.oIndex,0),this._setTransition(this.nIndex,0),this._setTransition(this.dIndex,0),this.after&&this.after.call(this,this.index,this.elements[this.index])},_setTransitionStart:function(t){this._setTransition(this.index,t),this._setTransition(this.oIndex,t),this._setTransition(this.nIndex,t),this._setTransition(this.dIndex,t),this.before&&this.before.call(this,this.index,this.elements[this.index])},_setIndex:function(t){this.index=t,this.index>this.length-1&&(this.index=0),this.index<0&&(this.index=this.length-1),this.nIndex=t+1,this.nIndex>this.length-1&&(this.nIndex=0),this.oIndex=t-1,this.oIndex<0&&(this.oIndex=this.length-1)},_setStack:function(t,s){this.elements[t].style.zIndex=s},_setStacks:function(t){this._setStack(this.index,2),"left"===t?(this._setStack(this.oIndex,1),this._setStack(this.nIndex,3)):"right"===t?(this._setStack(this.oIndex,3),this._setStack(this.nIndex,1)):"center"===t&&(this._setStack(this.oIndex,1),this._setStack(this.nIndex,1))},_setDisplay:function(s,i){t.css(this.elements[s],"display")!==i&&(this.elements[s].style.display=i)},_setActive:function(s){this._setIndex(s),this._setDisplay(this.nIndex,"block"),this._setDisplay(this.oIndex,"block"),this._setDisplay(this.index,"block"),this._setTransform(this.index,this.centerX,0,1),this._setTransform(this.nIndex,this.rightX,0,this.ratio),this._setTransform(this.oIndex,this.leftX,0,this.ratio),this._setStacks("center"),t.addClass(this.elements[this.index],this.active),t.removeClass(this.elements[this.nIndex],this.active),t.removeClass(this.elements[this.oIndex],this.active)},_setFourth:function(s,i){var e=0;"right"===i?(this.dIndex=s-1,e=this.leftPos):"left"===i&&(this.dIndex=s+1,e=this.rightPos),this.dIndex>this.length-1&&(this.dIndex=0),this.dIndex<0&&(this.dIndex=this.length-1),"block"!==t.css(this.elements[this.dIndex],"display")&&(this._setDisplay(this.dIndex,"block"),this._setTransform(this.dIndex,e,0,this.ratio))},_reset:function(){this.deltaX=this.deltaY=0,this.moveX=this.moveY=null,this.moved=!1},_reStore:function(){this._setTransitionStart(this.duration),this._setTransform(this.index,this.centerX,0,1),this._setTransform(this.oIndex,this.leftX,0,this.ratio),this._setTransform(this.nIndex,this.rightX,0,this.ratio),this.deltaX>0?(this._setTransform(this.dIndex,this.leftPos,0,this.ratio),this._setStacks("center")):(this._setTransform(this.dIndex,this.rightPos,0,this.ratio),this._setStacks("center")),setTimeout(function(){this._setTransitionEnd(),this._setDisplay(this.dIndex,"none")}.bind(this),this.duration)},prev:function(){this.animated||(this.animated=!0,this._setFourth(this.oIndex,"right"),this._setStacks("right"),setTimeout(function(){this._setTransform(this.index,this.rightX,0,this.ratio),this._setTransform(this.oIndex,this.centerX,0,1),this._setTransform(this.nIndex,this.rightPos,0,this.ratio),this._setTransform(this.dIndex,this.leftX,0,this.ratio),this._setTransitionStart(this.duration)}.bind(this),0),setTimeout(function(){this._setTransitionEnd(),this._setDisplay(this.nIndex,"none"),this._setActive(this.oIndex)}.bind(this),this.duration))},next:function(){this.animated||(this.animated=!0,this._setFourth(this.nIndex,"left"),this._setStacks("left"),setTimeout(function(){this._setTransform(this.index,this.leftX,0,this.ratio),this._setTransform(this.oIndex,this.leftPos,0,this.ratio),this._setTransform(this.nIndex,this.centerX,0,1),this._setTransform(this.dIndex,this.rightX,0,this.ratio),this._setTransitionStart(this.duration)}.bind(this),0),setTimeout(function(){this._setTransitionEnd(),this._setDisplay(this.oIndex,"none"),this._setActive(this.nIndex)}.bind(this),this.duration))}},"function"==typeof define&&(define.amd||define.cmd)?define("mCarousel",[],function(){return s}):window.mCarousel=s}();